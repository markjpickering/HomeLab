---
# Main playbook for deploying k3s clusters
# This playbook installs k3s servers (control plane) and agents (workers)

- name: Deploy k3s control plane
  hosts: k3s_servers
  become: yes
  roles:
    - k3s-server

- name: Deploy k3s worker nodes
  hosts: k3s_agents
  become: yes
  roles:
    - k3s-agent
  vars:
    # Get server address from first server in group
    k3s_server_host: "{{ hostvars[groups['k3s_servers'][0]]['ansible_default_ipv4']['address'] }}"
    # Token is generated by server role
    k3s_node_token: "{{ hostvars[groups['k3s_servers'][0]]['k3s_node_token'] }}"