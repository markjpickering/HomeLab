# k3s server configuration
# Generated by Ansible for {{ inventory_hostname }}

# Bind to ZeroTier interface
bind-address: "{{ ansible_default_ipv4.address }}"
advertise-address: "{{ ansible_default_ipv4.address }}"

# Cluster settings
cluster-cidr: "10.42.0.0/16"
service-cidr: "10.43.0.0/16"
cluster-dns: "10.43.0.10"

# Disable built-in services we'll manage separately (optional)
{% if disable_traefik | default(false) %}
disable:
  - traefik
{% endif %}
{% if disable_servicelb | default(false) %}
  - servicelb
{% endif %}

# TLS settings
tls-san:
  - "{{ inventory_hostname }}"
  - "{{ ansible_default_ipv4.address }}"
{% if k3s_tls_sans is defined %}
{% for san in k3s_tls_sans %}
  - "{{ san }}"
{% endfor %}
{% endif %}

# Write kubeconfig with correct server address
write-kubeconfig-mode: "0644"

# Node labels
node-label:
  - "site={{ site_name | default('unknown') }}"
  - "node-type=server"

# Flannel backend (use wireguard for better security over ZeroTier)
flannel-backend: "{{ k3s_flannel_backend | default('vxlan') }}"
